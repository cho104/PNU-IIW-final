<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body>
  <!-- 첫 번째 드롭다운 -->
  <label for="firstSelect">시/도:</label>
  <select id="firstSelect" onchange="updateSecondSelect()">
    <option value="">-- 선택하세요 --</option>
    <option value="a">서울</option>
    <option value="b">부산</option>
    <option value="c">C</option>
  </select>

  <!-- 두 번째 드롭다운 -->
  <label for="secondSelect">시군구:</label>
  <select id="secondSelect" onchange="generateURL()">
    <option value="">-- 먼저 첫 번째를 선택하세요 --</option>
  </select>

  <!-- 세 번째 드롭다운 (독립적인 선택지) -->
  <label for="thirdSelect">성별:</label>
  <select id="thirdSelect" onchange="generateURL()">
    <option value="">-- 선택하세요 --</option>
    <option value="x">남</option>
    <option value="y">여</option>
    <option value="z">모름</option>
  </select>

  <!-- 서버 전송 버튼 -->
  <button onclick="sendToServer()">확인</button>

  <script>
    // 숫자 코드 매핑
    const codeMap = {
      a: 6110000,
      b: 6410000,
      c: 6280000,
      '강북구': 3080000,
      '강남구': 3220000,
      '강동구': 3240000,
      'b-2': 302,
      'c-1': 401,
      'c-2': 402,
      x: 'M',
      y: 'F',
      z: 'Q'
    };

    const subOptions = {
      a: ['강북구', '강남구', '강동구'],
      b: ['b-2'],
      c: ['c-1', 'c-2']
    };

    let generatedUrl = "";

    function updateSecondSelect() {
      const first = $("#firstSelect").val();
      const secondSelect = $("#secondSelect");
      secondSelect.empty();

      if (first && subOptions[first]) {
        subOptions[first].forEach(option => {
          secondSelect.append(
            $("<option>").val(option).text(option)
          );
        });
      } else {
        secondSelect.append($("<option>").val("").text("-- 먼저 첫 번째를 선택하세요 --"));
      }

      generateURL();
    }

    function generateURL() {
      const first = $("#firstSelect").val();
      const second = $("#secondSelect").val();
      const third = $("#thirdSelect").val();

      const firstCode = codeMap[first] || "";
      const secondCode = codeMap[second] || "";
      const thirdCode = codeMap[third] || "";

      generatedUrl = "https://apis.data.go.kr/1543061/abandonmentPublicService_v2/abandonmentPublic_v2"
        + "?serviceKey=H18CHwE9DvQgtg5Gq0s4gyB%2B7jc7Qb2VHvbDRIQwxlYmxQL4dKuZVPMsOV1YapF8gGUjpodSnwMVD4qYNPslTA%3D%3D"
        + "&upr_cd=" + firstCode
        + "&org_cd=" + secondCode
        + "&sex_cd=" + thirdCode;
    }

    function sendToServer() {
      if (!generatedUrl) {
        alert("세 항목 중 하나 이상을 선택해주세요.");
        return;
      }

      $.ajax({
        type: "GET",
        url: generatedUrl,
        success: function(response) {
          console.log("서버 응답:", response);
          alert("서버로 전송 완료!");
        },
        error: function(xhr, status, error) {
          console.error("에러 발생:", error);
          alert("전송 실패 (CORS 에러일 수 있음)");
        }
      });
    }
  </script>
</body>
</html>
